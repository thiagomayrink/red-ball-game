<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <title>Red Ball</title>

    <style>
      body {
        background: #ccc;
        margin: 0;
      }
    </style>
  </head>

  <body>
    <canvas
      id="canvas"
      onmousemove="onMouseMove(event)"
      onclick="startGame()"
    ></canvas>

    <script>
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;

      const canvas = document.querySelector("#canvas");
      canvas.width = screenWidth;
      canvas.height = screenHeight;
      const context = canvas.getContext("2d");

      let gameloopIntervalId;
      let summonEnemyIntervalId;

      class Player {
        constructor(x, y) {
          this.x = x;
          this.y = y;
          this.radius = 100;
          this.color = "red";
        }
        draw() {
          drawCircle(this.x, this.y, this.radius, this.color);
        }
      }

      class Enemy {
        constructor(x, y, speedX, speedY) {
          this.x = x;
          this.y = y;
          this.speedX = speedX;
          this.speedY = speedY;
          this.color = "blue";
          this.radius = 30;
        }

        draw() {
          drawCircle(this.x, this.y, this.radius, this.color);
        }

        move() {
          this.x += this.speedX;
          this.y += this.speedY;
        }

        increaseSpeed() {
          this.speedX *= 1.001;
          this.speedY *= 1.001;
        }

        checkCollisionAgainstPlayer() {
          const distance = Math.sqrt(
            (player.x - this.x) ** 2 + (player.y - this.y) ** 2
          );

          return distance < player.radius + this.radius;
        }

        bounceOnEdge() {
          if (this.x < 0 || this.x > screenWidth) {
            this.speedX *= -1;
          }

          if (this.y < 0 || this.y > screenHeight) {
            this.speedY *= -1;
          }
        }
      }

      function summonEnemy() {
        enemies.push(new Enemy(0, 0, 10, 10));
      }

      function onMouseMove(event) {
        player.x = event.clientX;
        player.y = event.clientY;
      }

      function drawCircle(x, y, radius, color) {
        context.beginPath();
        context.fillStyle = color;
        context.arc(x, y, radius, 0, 2 * Math.PI);
        context.fill();
      }

      function clearScreen() {
        context.clearRect(0, 0, canvas.width, canvas.height);
      }

      function endGame() {
        canvas.style.cursor = "pointer";
        setTimeout(() => {
          alert("Fim do jogo!");
        }, 50);
        clearInterval(summonEnemyIntervalId);
        clearInterval(gameloopIntervalId);
      }

      const enemy = new Enemy();
      const player = new Player();
      let enemies = [];

      function startGame() {
        player.x = screenWidth / 2;
        player.y = screenHeight / 2;

        canvas.style.cursor = "none";

        enemies = [];
        summonEnemy();

        clearInterval(summonEnemyIntervalId);
        clearInterval(gameloopIntervalId);

        summonEnemyIntervalId = setInterval(summonEnemy, 5000);
        gameloopIntervalId = setInterval(gameLoop, 1000 / 60);
      }

      function moveEnemies() {
        enemies.forEach((enemy) => enemy.move());
      }

      function handleEnemiesBounce() {
        enemies.forEach((enemy) => enemy.bounceOnEdge());
      }

      function increaseEnemiesSpeed() {
        enemies.forEach((enemy) => enemy.increaseSpeed());
      }

      function drawEnemies() {
        enemies.forEach((enemy) => enemy.draw());
      }
      function gameLoop() {
        clearScreen();

        moveEnemies();

        enemies.forEach((enemy) => {
          if (enemy.checkCollisionAgainstPlayer()) endGame();
        });

        increaseEnemiesSpeed();
        handleEnemiesBounce();
        player.draw();
        drawEnemies();
      }

      startGame();
    </script>
  </body>
</html>
